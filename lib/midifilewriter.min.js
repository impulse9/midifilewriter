/*
 *  MIDIFileWriter
 *
 *  0.8.0
 *
 *  (c) 2017 Danijel Durakovic
 *  MIT license
 *
 */
 var MIDIfw=function(){"use strict";function t(t,n){for(var e=new Array(n),r=n-1;r>=0;r--)e[r]=255&t,t>>=8;return e}function n(t){var n=[],e=!0;do{var r=127&t;t>>=7,e?(n.unshift(r),e=!1):n.unshift(128|r)}while(t>0);return n}function e(t){for(var n=t.byteLength,e="",r=0;n>r;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function r(n){var e=n&&n.channel&&n.channel>=0&&n.channel<=C?n.channel:l,r=[];this.setInstrument=function(t){if(void 0!==t&&void 0!==t.instrument){var n=t.time||0,i=t.instrument,a=new D.programChange(n,e,i);r.push(a)}},this.noteOn=function(t){if(void 0!==t&&void 0!==t.time&&void 0!==t.note){var n=t.time,i=0,a=t.note,o=t.velocity||w;if(a>=0&&I>=a&&o>=0&&P>=o){var c=new D.note(n,e,i,a,o);r.push(c)}}},this.noteOff=function(t){if(void 0!==t&&void 0!==t.time&&void 0!==t.note){var n=t.time,i=t.note,a=1,o=0;if(i>=0&&I>=i){var c=new D.note(n,e,a,i,o);r.push(c)}}},this.getBytes=function(n){var e,i=s,a=[];if(n instanceof Array){var o=n.length;for(e=0;o>e;e++)a=a.concat(n[e].getBytes())}var c=r.length;for(e=0;c>e;e++)a=a.concat(r[e].getBytes());var u=new D.meta(m);return a=a.concat(u.getBytes()),i=i.concat(t(a.length,4)),i=i.concat(a)}}function i(n){function i(){var n=g.length,e=n>1?n+1:n,r=a;return r=r.concat(o),r=r.concat(n>1?u:c),r=r.concat(t(e,2)),r=r.concat(t(h,2))}function s(){var n=new D.meta(B,d),e=t(Math.floor(6e7/v),3),r=new D.meta(y,e);return[n,r]}function f(){var t=g.length,n=i(),e=s();if(t>1){var a=new r;n=n.concat(a.getBytes(e))}for(var o=0;t>o;o++){var c=g[o],u=1===t&&0===o?c.getBytes(e):c.getBytes();n=n.concat(u)}return n}var h=n&&n.ticksPerBeat&&n.ticksPerBeat>0&&n.ticksPerBeat<=b?n.ticksPerBeat:p,v=n&&n.tempo&&n.tempo>0?n.tempo:k,g=[];this.addTrack=function(t){g.push(t)},this.getBytes=function(){return new Uint8Array(f())},this.getBase64=function(){return e(this.getBytes())},this.getDataURI=function(){return A+this.getBase64()}}var a=[77,84,104,100],o=[0,0,0,6],c=[0,0],u=[0,1],s=[77,84,114,107],f=144,h=128,v=192,g=255,m=47,B=88,y=81,d=[4,2,24,8],l=0,w=64,p=96,k=60,C=15,I=127,P=127,b=65535,A="data:audio/midi;base64,",D={note:function(t,e,r,i,a){this.getBytes=function(){var o=n(t),c=e|(r?h:f);return o.push(c,i,a),o}},programChange:function(t,e,r){this.getBytes=function(){var i=n(t),a=e|v;return i.push(a,r),i}},meta:function(t,e){this.getBytes=function(){e=e||[];var r=0,i=n(r);return i.push(g,t),i=i.concat(n(e.length)),i=i.concat(e)}}};return{createTrack:function(t){return new r(t)},createFile:function(t){return new i(t)}}}();